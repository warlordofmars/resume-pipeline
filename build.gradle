/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */


buildscript {
    repositories {
        mavenCentral()
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {
        classpath "jp.classmethod.aws:gradle-aws-plugin:0.30"
        classpath "javax.xml.bind:jaxb-api:2.3.0"
    }
}

ext {
    cloudformationBucket = 'warlordofmars-cloudformation'
}


apply plugin: 'jp.classmethod.aws.cloudformation'

cloudFormation {
    stackName "resume-website"
    templateFile file("resume_website/resume.warlordofmars.net.yaml")
    templateBucket cloudformationBucket
    templateKeyPrefix "resume-website"
    stackParams ([
        'DomainName': "warlordofmars.net",
        'FullDomainName': "resume-test.warlordofmars.net",
        'AcmCertificateArn': "arn:aws:acm:us-east-1:247631471946:certificate/471106fc-e3dd-4e0b-a20f-010a6e326283"
    ])
}

task('deployStack') {
    dependsOn awsCfnMigrateStackAndWaitCompleted
}

task('deleteStack') {
    dependsOn awsCfnDeleteStackAndWaitCompleted
}

awsCfnMigrateStack.dependsOn awsCfnUploadTemplate

task('build') {
    doFirst {
        exec {
            commandLine 'hackmyresume', 'build', 'resume/resume.json', 'TO', 'out/resume.all', '-t', 'resume_theme/node_modules/jsonresume-theme-short/'
        }
    }
}

task('analyze') {
    doFirst {
        exec {
            commandLine 'hackmyresume', 'analyze', 'resume/resume.json'
        }
    }
}

task('validate') {
    doFirst {
        exec {
            commandLine 'hackmyresume', 'validate', 'resume/resume.json'
        }
    }
}

task('print') {
    mustRunAfter build
    doFirst {
        exec {
            commandLine 'lp', 'out/resume.pdf'
        }
    }
}

task('deploy') {
    mustRunAfter build
    dependsOn deployStack
    doFirst {
        exec {
            commandLine 'aws', 's3', 'cp', 'out/resume.html', 's3://resume-test.warlordofmars.net/index.html'
        }
    }
}